<!doctype html>
<html>

    <!-- 
    This is a tool to copy data using the built-in Windows robocopy command.

    Author: Justin Chapdelaine
    Source: https://github.com/justinchapdelaine/copy-tool

    This is a program created with HTAs (HTML Applications). 
    https://docs.microsoft.com/en-us/previous-versions//ms536496(v=vs.85) 
    -->

    <head>
        <!--
        @tag hta:application

        @attribute ApplicationName	Sets the name of the HTA.

        @attribute Border			[Thick]|Thin|None
        @attribute BorderStyle		[Normal]|Raised|Sunken|Complex|Static
        @attribute Caption			[Yes]|No
        @attribute ContextMenu		[Yes]|No
        @attribute Icon				Path/To/Icon.ico
        @attribute MaximizeButton	[Yes]|No
        @attribute MinimizeButton	[Yes]|No
        @attribute Navigable		[Yes]|No
        @attribute Scroll			[Auto]|Yes|No
        @attribute Selection		[Yes]|No
        @attribute ShowInTaskbar	[Yes]|No
        @attribute SingleInstance	[Yes]|No
        @attribute SysMenu			[Yes]|No (Setting to No will remove close button)
        @attribute WindowsState		[Normal]|Minimize|Maximize
        -->
        <hta:application
            ID="ct"
            ApplicationName="Copy Tool"
            Icon=""
            Scroll="Yes"
        >

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=8" />
        <meta name="description" content="Tool to copy data using Windows built-in robocopy command.">

        <title>Copy Tool</title>

        <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous">
        
        <!--[if lte IE 8]>
            <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-old-ie-min.css">
        <![endif]-->
        <!--[if gt IE 8]><!-->
            <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-min.css">
        <!--<![endif]-->

    </head>

    <script language="VBScript">

        ' Set window size '
        window.resizeTo 900, 475

        ' Folder names '
        Dim sourceFolder
        Dim destinationFolder

        ' If toolkit is not running with elevated permissions, self elevate '
        If HTAElevate() = True Then 
            ' Self Elevate '
        End If 

        Function HTAElevate() 

            Const Elev = " /elevated" 
            HTAElevate = True 

            If InStr( LCase( ct.commandLine ), Elev) > 0 then Exit Function 

            On Error Resume Next 
                window.resizeTo width, height
            On Error GoTo 0 

            createobject("Shell.Application").ShellExecute "mshta.exe", ct.commandLine & Elev, "", "runas", 1 

            HTAElevate = False      
            self.close 
            
        End Function    

        Function browseForSource()
            '@description: Browse for folder dialog.
            '@author: Jeremy England (SimplyCoded)
            Dim oFolder
            Set oFolder = CreateObject("Shell.Application").BrowseForFolder(0,"Select a Folder",0,0)
            If (oFolder Is Nothing) Then
                BrowseForFolder = Empty
            Else 
                BrowseForFolder = oFolder.Self.Path
                source.Value = BrowseForFolder
                sourceFolder = oFolder.Self
            End If
        End Function

        Function browseForDestination()
            '@description: Browse for folder dialog.
            '@author: Jeremy England (SimplyCoded)
            Dim oFolder
            Set oFolder = CreateObject("Shell.Application").BrowseForFolder(0,"Select a Folder",0,0)
            If (oFolder Is Nothing) Then
                BrowseForFolder = Empty
            Else 
                BrowseForFolder = oFolder.Self.Path
                destination.Value = BrowseForFolder
                destinationFolder = oFolder.Self
            End If
        End Function

        ' Determine total size of source folder '
        Function sizeOfSource()
            Set objShell = CreateObject("Wscript.Shell")

            Dim copy, tempDestination
            tempDestination = "C:\STS"

            copy = "robocopy " & Chr(34) & source.Value & "." & Chr(34) & " " & Chr(34) & tempDestination & "." & Chr(34) & " /e /xj /eta /r:1 /w:0 /zb /efsraw /v /xf desktop.ini /np /njh /ndl /nc /ns /nfl /l"

            objShell.Run "cmd.exe /c echo Calculating size of the source folder. This may take a few minutes... & " & copy & " & echo See the toal size above & echo. & pause"
        End Function

        ' Copy all data from source to destination using robocopy '
        Sub startCopy()
            Set objShell = CreateObject("Wscript.Shell")

            Dim copy
            Dim echo
           
           ' If the user enters folder path manually then we need to determine the source folder name '
            if sourceFolder = "" Then
                Dim start
                sourceFolder = source.Value

                start = InStrRev(sourceFolder, "\")
                sourceFolder = Right(sourceFolder, start + 2)

                sourceFolder = Replace(sourceFolder,":","")
                sourceFolder = Replace(sourceFolder,"\","")

                ' Test folder name output '
                ' objShell.Run "cmd.exe /c echo " & sourceFolder & " & pause" '
            End if

            sourceFolder = Replace(sourceFolder,":","")
            destinationFolder = Replace(destinationFolder,":","")

            copy = "robocopy " & Chr(34) & source.Value & "." & Chr(34) & " " & Chr(34) & destination.Value & "\" & sourceFolder & "." & Chr(34) & " /e /xj /eta /r:1 /w:0 /zb /efsraw /a-:h /v /xf desktop.ini /log:" & Chr(34) & destination.Value & "\CopyLog-" & sourceFolder &  ".txt" & Chr(34) & " /np /tee"
            
            ' Testing Runs '
            ' echo = "echo Source: " & sourceFolder & " // Destination: " & destinationFolder '
            ' objShell.Run "cmd.exe /c echo " & copy & " && pause" '

            objShell.Run "cmd.exe /c " & copy & " & echo Copied all data from " & source.Value & " to " & destination.Value & " & echo A log has been saved to " & destination.Value & "\CopyLog-" & sourceFolder & ".txt" & " & echo. & pause"

            ' Reset source folder to blank for additional copy runs '
            sourceFolder = ""
        End Sub

    </script>

    <body style="padding:0px 25px 0px 25px;">

        <!-- Heading -->
        <div class="pure-menu pure-menu-horizontal">
            <div class="pure-menu-heading" style="color: rgb(202, 60, 60); padding:0px;"><h2>Copy Tool</h2></div>
            <div class="pure-menu-item" style="color: rgb(128,128,128); padding:0px;"><p>|</p></div>
            <div class="pure-menu-item" style="color: rgb(128,128,128); padding:0px;"><p>utilizing the built-in robocopy command</p></div>
        </div>

        <!-- Get Source -->
        <form class="pure-form">
            <fieldset>
                <legend>Source</legend>
            </fieldset>
        </form>

        <div class="pure-form">
            <div class="pure-u-1-1">
                <input class="pure-input-2-3" type="text" name="source" id="source" style="color: rgb(128,128,128)" value="Enter or browse for source...">
                <button class="pure-button" name="browseSource" id="browseSource" onclick="browseForSource">Browse</button>
                <button class="pure-button" name="sizeSource" id="sizeSource" onclick="sizeOfSource">Source Size</button>
            </div>
        </div>

        <br />

        <!-- Get destination -->
        <form class="pure-form">
            <fieldset>
                <legend>Destination</legend>
            </fieldset>
        </form>

        <div class="pure-form">
            <div class="pure-u-1-1">
                <input class="pure-input-2-3" type="text" name="destination" id="destination" style="color: rgb(128,128,128)" value="Enter or browse for destination...">
                <button class="pure-button" name="browseDestination" id="browseDestination" onclick="browseForDestination">Browse</button>
            </div>
        </div>

        <br />

        <!-- Start copying -->
        <div class="pure-g">
            <div class="pure-u-1-1"><button class="pure-button pure-button-primary" name="start" id="start" onclick="startCopy">Start Copy</button></div>
        </div>

        <!-- Link to GitHub -->
        <div class="footer" style="color: rgb(211,211,211); font-size: .75em; text-align: center; padding: 0px; margin: auto">
            <div class="pure-menu pure-menu-horizontal">
                    <li class="pure-menu-item"><a href="https://github.com/justinchapdelaine/copy-tool" class="pure-menu-link" style="padding: 0px;">Found a bug or have a suggestion? Head on over to the GitHub!</a></li>
            </div>
        </div>


    </body>
</html>